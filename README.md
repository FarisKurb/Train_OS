# Симуляция движения поездов по маршруту Душанбе — Гиссар — Регар — Пахтаабад

## Постановка задачи

Необходимо разработать C++-программу, моделирующую движение поездов по железнодорожной ветке  
**Душанбе — Гиссар — Регар — Пахтаабад**.  

Требования:

1. Минимум **8 поездов**, каждый — **отдельный поток** с уникальным номером.
2. Поезда движутся по циклическому маршруту: после Пахтаабада возвращаются к Душанбе.
3. У каждой станции должен быть **один общий ресурс** — платформа, доступ к которой осуществляют **по одному поезду одновременно** (через общий `station_lock`).
4. Все события должны выводиться в консоль:
   - начало движения;
   - прибытие на станцию;
   - стоянка;
   - отправление;
   - остановка поезда при завершении симуляции.
5. Время движения между станциями и время стоянки — **разные случайные интервалы**.
6. Симуляция работает **до тех пор, пока пользователь не нажмёт Enter**.

---

## Работа программы

1. При запуске создаётся маршрут из четырёх станций.  
2. Инициализируются восемь поездов, каждому присваивается:
   - номер;
   - стартовая станция (индекс 0);
   - активное состояние.
3. Каждый поезд запускается в отдельном потоке и выполняет бесконечный цикл:
   - логирует начало движения к следующей станции;
   - выполняет задержку (имитация пути);
   - запрашивает доступ к платформе станции через общий `station_lock`;
   - логирует прибытие;
   - выполняет задержку стоянки;
   - логирует отправление;
   - освобождает платформу;
   - переходит к следующей станции по кругу.
4. В главном потоке программа ждёт нажатия Enter.
5. После сигнала поезда завершают цикл и выводят сообщение о завершении.

---

## Вывод программы (пример реального выполнения)
```console
PRESS ENTER TO STOP...
[20:12:04] Train 1 MOVING TO Dushanbe
[20:12:04] Train 2 MOVING TO Dushanbe
[20:12:04] Train 6 MOVING TO Dushanbe
[20:12:04] Train 4 MOVING TO Dushanbe
[20:12:04] Train 5 MOVING TO Dushanbe
[20:12:04] Train 3 MOVING TO Dushanbe
[20:12:04] Train 7 MOVING TO Dushanbe
[20:12:04] Train 8 MOVING TO Dushanbe
[20:12:05] Train 6 ARRIVED at Dushanbe
[20:12:07] Train 6 LEAVING Dushanbe
[20:12:07] Train 6 MOVING TO Gissar
[20:12:07] Train 1 ARRIVED at Dushanbe
[20:12:08] Train 1 LEAVING Dushanbe
[20:12:08] Train 1 MOVING TO Gissar
[20:12:08] Train 4 ARRIVED at Dushanbe
[20:12:10] Train 4 LEAVING Dushanbe
[20:12:10] Train 4 MOVING TO Gissar
[20:12:10] Train 2 ARRIVED at Dushanbe
[20:12:11] Train 2 LEAVING Dushanbe
[20:12:11] Train 2 MOVING TO Gissar
[20:12:11] Train 8 ARRIVED at Dushanbe
[20:12:13] Train 8 LEAVING Dushanbe
[20:12:13] Train 8 MOVING TO Gissar
[20:12:13] Train 7 ARRIVED at Dushanbe
[20:12:14] Train 7 LEAVING Dushanbe
[20:12:14] Train 7 MOVING TO Gissar
[20:12:14] Train 5 ARRIVED at Dushanbe
[20:12:16] Train 5 LEAVING Dushanbe
[20:12:16] Train 5 MOVING TO Gissar
[20:12:16] Train 3 ARRIVED at Dushanbe
[20:12:17] Train 3 LEAVING Dushanbe
[20:12:17] Train 3 MOVING TO Gissar
[20:12:17] Train 6 ARRIVED at Gissar
[20:12:19] Train 6 LEAVING Gissar
[20:12:19] Train 6 MOVING TO Regar
[20:12:19] Train 1 ARRIVED at Gissar

[20:12:20] Train 1 LEAVING Gissar
[20:12:20] Train 1 STOPPED
[20:12:20] Train 4 ARRIVED at Gissar
[20:12:22] Train 4 LEAVING Gissar
[20:12:22] Train 4 STOPPED
[20:12:22] Train 2 ARRIVED at Gissar
[20:12:23] Train 2 LEAVING Gissar
[20:12:23] Train 2 STOPPED
[20:12:23] Train 8 ARRIVED at Gissar
[20:12:24] Train 8 LEAVING Gissar
[20:12:24] Train 8 STOPPED
[20:12:24] Train 7 ARRIVED at Gissar
[20:12:26] Train 7 LEAVING Gissar
[20:12:26] Train 7 STOPPED
[20:12:26] Train 5 ARRIVED at Gissar
[20:12:27] Train 5 LEAVING Gissar
[20:12:27] Train 5 STOPPED
[20:12:27] Train 3 ARRIVED at Gissar
[20:12:29] Train 3 LEAVING Gissar
[20:12:29] Train 3 STOPPED
[20:12:29] Train 6 ARRIVED at Regar
[20:12:31] Train 6 LEAVING Regar
[20:12:31] Train 6 STOPPED
Simulation finished!
```

---

## Анализ вывода

1. **Все поезда начинают одновременно**, но за счёт случайных задержек порядок прибытия меняется.  
2. **Только один поезд прибывает на станцию в единицу времени**, что подтверждает корректную работу общего `station_lock`.  
3. Если поезд подходит к станции, когда она занята другим, он **ждёт**, что отражается в задержках между выводами.
4. Поезда проходят по маршруту цикл за циклом: Душанбе → Гиссар → Регар → Пахтаабад → Душанбе.
5. После нажатия Enter поезда корректно завершают текущие операции и выводят сообщение `STOPPED`, что говорит о правильной работе флага активности и корректном завершении потоков.
6. Deadlock не возникает: все поезда завершаются и общий ресурс освобождается всегда.

---

## Заключение

Реализованная программа удовлетворяет требованиям:

- использовано 8 потоков;  
- введён общий ресурс станции, защищённый mutex;  
- события логируются с понятной структурой;  
- движение и стоянка имеют случайную продолжительность;  
- симуляция работает бесконечно и завершается по сигналу пользователя;  
- последовательность работы поездов соответствует реальному принципу очередности.

Вывод корректно демонстрирует работу синхронизации, показывает отсутствие взаимных блокировок и реалистичное распределение поездов по маршруту.
